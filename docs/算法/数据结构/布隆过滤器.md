# 布隆过滤器

布隆过滤器（Bloom Filter）是1970年由布隆提出的。它实际上是一个很长的二进制向量和一系列随机映射函数。布隆过滤器可以用于检索一个元素是否在一个集合中。它的优点是空间效率和查询时间都比一般的算法要好的多，缺点是有一定的误识别率和删除困难。
​

### 使用场景

布隆过滤器可以确切的知道这个数

- 不存在则一定不存在
- 存在可能会不存在（误判）

场景：

- 解决Redis 缓存穿透问题
- 邮件过滤
- 对爬虫网址进行过滤


### 布隆过滤器原理


##### 布隆过滤器的数据结构

布隆过滤器它实际上是一个很长的二进制向量和一系列随机映射函数。以Redis中的布隆过滤器实现为例，Redis中的布隆过滤器底层是一个大型位数组（二进制数组）+多个无偏hash函数。

一个大型位数组（二进制数组） 0和1组成

多个无偏hash函数 ：无偏hash函数就是能把元素的hash值计算的比较均匀的hash函数，能使得计算后的元素下标比较均匀的映射到位数组中。


##### 空间计算

布隆过滤器提供了两个参数：

- 预计加入元素的大小n
- 运行的错误率f
  
根据这两个参数会计算出二进制数组的大小l，以及无偏hash函数的个数k。

- 错误率越低，位数组越长，控件占用较大
- 错误率越低，无偏hash函数越多，计算耗时较长


##### 增加元素

往布隆过滤器增加元素，添加的key需要根据k个无偏hash函数计算得到多个hash值，然后对数组长度进行取模得到数组下标的位置，然后将对应数组下标的位置的值置为1

- 通过k个无偏hash函数计算得到k个hash值
- 依次取模数组长度，得到数组索引
- 将计算得到的数组索引下标位置数据修改为1

多个hash值 会得到多个数组下标，数组下标的位置都会发生更改

##### 查询元素

布隆过滤器最大的用处就在于判断某样东西一定不存在或者可能存在，而这个就是查询元素的结果。其查询元素的过程如下：

- 通过k个无偏hash函数计算得到k个hash值
- 依次取模数组长度，得到数组索引
- 判断索引处的值是否全部为1，如果全部为1则存在（这种存在可能是误判），如果存在一个0则必定不存在

误判发生的原因：hash冲突的产生



