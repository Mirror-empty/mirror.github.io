### 分区与文件系统

对分区进行格式化是为了在分区上建立文件系统。一个分区通常只能格式化为一个文件系统，但是磁盘阵列等技术可以将一个分区格式化为多个文件系统。

### 组成
最主要的几个组成部分如下：

- inode(索引节点)：一个文件占用一个inode，记录文件的属性，同时记录此文件的内容所在的block编号；
- block：记录文件的内容，文件太大时，会占用多个block。
- superblock：记录文件系统的整体信息，包括inode和block的总量、使用量、剩余量，以及文件系统的各式与相关信息等；
- block bitmap：记录block是否被使用的位图。

### 文件读取
对于Ext2文件系统，当要读取一个文件的内容时，现在inode中查找文件内容所在的所有block，然后把block的内容读出来。


而对于FAT文件系统，它没有inode，每个block中存储着下一个block的编号。

###   磁盘碎片

指一个文件内容所在的block过于分散，导致磁盘磁头移动距离过大，从而降低磁盘读写性能。

   1.block

在Ext2文件系统中所支持的block大小有1k，2k，4k三种，不同的大小限制了单个文件和文件系统的最大大小。

|大小|1kb|2kb|4kb|
|--|--|--|--|
|最大单元文件|16GB|256GB|2TB|
|最大文件系统|2TB|8TB|16TB|

一个block只能被一个文件所使用，未使用的部分之间浪费了。所以小文件用小的block。

2.inode

inode具体包含以下信息：
- 权限 (read/write/excute)；
- 拥有者与群组 (owner/group)；
- 容量；
- 建立或状态改变的时间 (ctime)；
- 最近读取时间 (atime)；
- 最近修改时间 (mtime)；
- 定义文件特性的旗标 (flag)，如 SetUID...；
- 该文件真正内容的指向 (pointer)。

具有以下特点：
- 每个inode大小均固定为128bytes
- 每个文件都只有一个inode
  
inode 中记录了文件内容所在的 block 编号，但是每个 block 非常小，一个大文件随便都需要几十万的 block。而一个 inode 大小有限，无法直接引用这么多 block 编号。因此引入了间接、双间接、三间接引用。间接引用让 inode 记录的引用 block 块记录引用信息。

### #目录

建立一个目录时，会分配一个 inode 与至少一个 block。block 记录的内容是目录下所有文件的 inode 编号以及文件名。

可以看到文件的 inode 本身不记录文件名，文件名记录在目录中，因此新增文件、删除文件、更改文件名这些操作与目录的写权限有关。

### 日志
如果突然断电，那么文件系统会发生错误，例如断电前只修改了 block bitmap，而还没有将数据真正写入 block 中。

ext3/ext4 文件系统引入了日志功能，可以利用日志来修复文件系统。

### 挂载

挂载利用目录作为文件系统的进入点，也就是说，进入目录之后可以文件系统的数据。


### 目录配置

为了使不同 Linux 发行版本的目录结构保持一致性，Filesystem Hierarchy Standard (FHS) 规定了 Linux 的目录结构。最基础的三个目录如下：

- / (root, 根目录)
- /usr (unix software resource)：所有系统默认软件都会安装到这个目录；
- /var (variable)：存放系统或程序运行过程中的数据文件。

