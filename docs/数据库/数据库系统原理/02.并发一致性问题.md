# 02.并发一致性问题

在并发环境下，事务的隔离性很难保证，因此会出现很多并发一致性问题。

### 丢失修改

丢失修改指一个事务的更新操作被另外一个事务的更新操作替换。一般在显示生活中常会遇到，例如：T1和T2两个事务都对一个数据进行修改，T1先修改并提交生效，T2随后修改，T2的修改覆盖了T1的修改。

![zjaaUs.png](https://s1.ax1x.com/2022/12/23/zjaaUs.png)

如何解决：
    添加一个timestamp的字段，每次事务修改都要记录当前的时间戳，当更新时去判断与读取的时间戳是否一致。

### 读脏数据

读脏数据指在不同的事务下，当前事务可以读到另外事务未提交的数据。例如：T1修改一个数据但未提交，T2随后读取这个数据。如果T1撤销了这次修改，那么T2读取的数据是脏数据。

![zjdoYn.png](https://s1.ax1x.com/2022/12/23/zjdoYn.png)


###     不可重复读


不可重复读指在一个事务内多次去读取同一数据集合。在这一事务还未结束前，另一事务也访问了该同一数据集合并做了修改，由于第二个事务的修改，第一次事务的两次读取的数据可能不一致。例如：T2 读取一个数据，T1 对该数据做了修改。如果 T2 再次读取这个数据，此时读取的结果和第一次读取的结果不同。

![zjwapq.png](https://s1.ax1x.com/2022/12/23/zjwapq.png)


### 幻影读

幻读本质上也属于不可重复读的情况，T1读取某个范围的数据，T2在这个范围内插入新的数据，T1再次读取这个范围的数据，此时读取的结果和第一次读取的结果不同。

![zjyLCQ.png](https://s1.ax1x.com/2022/12/23/zjyLCQ.png)

产生并发不一致性问题的主要原因是破坏了事务的隔离性，解决方法是通过并发控制来保证隔离性。并发控制可以通过封锁实现，但是封锁操作需要用户自己控制，相当复杂。数据库管理系统提供了事务的隔离级别，让用户以一种更轻松的方式处理并发一致性问题。


