# 服务治理

## 服务治理，统一白名单控制

白名单服务属于业务系统开发过程中可重复使用的通用功能，所以我们可以把这样的工具型功能单独提炼出来设计成技术组件，由各个需要的使用此功能的系统工程引入使用



### 方案设计

白名单服务属于业务系统开发过程中可重复使用的通用功能，所以我们可以把这样的工具型功能单独提炼出来设计成技术组件，由各个需要的使用此功能的系统工程引入使用。

- 使用自定义注解、切面技术和SpringBoot对于配置文件的处理方式，开发白名单中间件。
- 在中间件中通过提取指定字段的入参与配置文件白名单用户列表做比对确认是否允许访问。
- 最后把开发好的中间件引入到需要依赖白名单服务的系统，在SpringBoot启动时进行加载。

相当于就是一个demo，给你深度了解一下，整个中间件开发的流程，

流程：

1. 定义一个Properties类来定义yml中前缀。
2. 定义一个配置类来加载配置信息，创建Bean对象返回需要的参数。
3. 定义一个切面类，来定义切点为对应的注解。
4. 切面类中的方法，@Around 环绕通知，对字符串进行白名单过滤。



##  服务治理，超时熔断

保证支付系统的可靠性需要考虑的点非常多，但这里有一个最直接和重点的内容就支付响应时长，如果支付时间过长，那么暴增的支付请求可能会把整个服务拖垮，最终导致所有服务瘫痪。

这时你可能会想到一个功能组件，超时熔断 hystrix。

> Spring Cloud Hystrix

Spring Cloud Hystrix 是基于 Netflix 公司的开源组件 Hystrix 实现的，它提供了熔断器功能，能够有效地阻止分布式微服务系统中出现联动故障，以提高微服务系统的弹性。Spring Cloud Hystrix 具有服务降级、服务熔断、线程隔离、请求缓存、请求合并以及实时故障监控等强大功能。


### 方案设计

很多时候你遇到的复杂场景问题，市面基本都有相应的解决方案，尤其是一些常见的问题都可以找到对应的技术实现工具。就像我们本章节所需要的调用超时要熔断保护系统，就有相应的技术组件 hystrix，它是 Netflix 公司开源的一款容错框架，在大部分 RPC 服务中也都有引入使用。

那如果我们只是想方便、简单并且不需要关心如何创建和返回结果的使用这样一个服务，就可以把 hystrix 的框架包装在中间里，屏蔽调用逻辑。

和白名单也是一个demo。


## 服务治理，调用限流


### 方案设计

RateLimiter 是令牌桶思想的一个实现，可实现流量整形、资源访问速率控制，在分布式部署的系统中大多数也是使用 RateLimiter 做限流处理。

RateLimiter是guava提供的基于令牌桶算法的实现类，可以非常简单的完成限流特技，并且根据系统的实际情况来调整生成token的速率。. 通常可应用于抢购限流防止冲垮系统；限制某接口、服务单位时间内的访问量，譬如一些第三方服务会对用户访问量进行限制；限制网速，单位时间内只允许上传下载多少字节等。



